<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenSockit Demo</title>
</head>
<body>
    <h1>OpenSockit Test</h1>
    <div id="status">Connecting...</div>
    <input type="text" id="messageInput" placeholder="Type a message">
    <button onclick="sendMessage()">Send</button>
    <div id="messages"></div>
    <div id="game">
        <button onclick="startGame()">Start New Game as Host</button>
        <div id="hostPanel" style="display:none;">
            <input type="number" id="secretNumber" placeholder="Enter secret number 1-100" min="1" max="100">
            <button onclick="setSecret()">Set Secret Number</button>
        </div>
        <div id="guessPanel">
            <input type="number" id="guessInput" placeholder="Guess 1-100" min="1" max="100">
            <button onclick="sendGuess()">Guess</button>
        </div>
        <div id="gameStatus"></div>
    </div>
    <script type="module">
        import opensockit from 'https://opensockit.onrender.com/opensockit.js';
        const sockit = new opensockit();
        let isHost = false;
        let secretNumber = null;

        sockit.connect().then(() => {
            document.getElementById('status').textContent = 'Connected!';
            sockit.getSocket().on('message', (msg) => {
                const div = document.getElementById('messages');
                div.innerHTML += '<p>Received: ' + msg + '</p>';

                // Game logic
                if (isHost && secretNumber && msg.startsWith('Guess: ')) {
                    const guess = parseInt(msg.split(': ')[1]);
                    if (isNaN(guess)) return;
                    if (guess < secretNumber) {
                        sockit.send('Higher!');
                    } else if (guess > secretNumber) {
                        sockit.send('Lower!');
                    } else {
                        sockit.send('Correct! You guessed it!');
                        resetGame();
                    }
                }
            });
        }).catch((error) => {
            document.getElementById('status').textContent = 'Connection failed: ' + error.message;
        });

        window.sendMessage = () => {
            const msg = document.getElementById('messageInput').value;
            sockit.send(msg);
            document.getElementById('messageInput').value = '';
        };

        window.startGame = () => {
            isHost = true;
            document.getElementById('hostPanel').style.display = 'block';
            document.getElementById('guessPanel').style.display = 'none';
            document.getElementById('gameStatus').textContent = 'Set your secret number.';
        };

        window.setSecret = () => {
            secretNumber = parseInt(document.getElementById('secretNumber').value);
            if (isNaN(secretNumber) || secretNumber < 1 || secretNumber > 100) {
                alert('Please enter a valid number between 1 and 100.');
                return;
            }
            document.getElementById('hostPanel').style.display = 'none';
            document.getElementById('gameStatus').textContent = 'Secret set. Waiting for guesses...';
            sockit.send('Game started! Guess my number between 1 and 100.');
        };

        window.sendGuess = () => {
            const guess = parseInt(document.getElementById('guessInput').value);
            if (isNaN(guess) || guess < 1 || guess > 100) {
                alert('Please enter a valid number between 1 and 100.');
                return;
            }
            sockit.send('Guess: ' + guess);
            document.getElementById('guessInput').value = '';
        };

        function resetGame() {
            isHost = false;
            secretNumber = null;
            document.getElementById('guessPanel').style.display = 'block';
            document.getElementById('hostPanel').style.display = 'none';
            document.getElementById('gameStatus').textContent = '';
        }
    </script>
</body>
</html>
